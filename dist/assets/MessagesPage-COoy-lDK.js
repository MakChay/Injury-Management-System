import{j as e,m as d,M as o,P as S,N as M}from"./ui-D_jLh_Lr.js";import{r as n}from"./vendor-B9gohGc-.js";import{u as _,a as p,l as f}from"./index-D5lOMFz8.js";import"./supabase-DOoHAlwf.js";import"./router-CIHs1KQM.js";function D(){var h;const{user:t}=_(),[j,b]=n.useState([]),[N,x]=n.useState(!0),[l,m]=n.useState(""),[r,v]=n.useState(null);n.useEffect(()=>{t&&g()},[t]);const g=async()=>{if(t)try{x(!0);const s=await p.getMessages(t.id);b(s)}catch(s){f.error("Error fetching messages:",s)}finally{x(!1)}},w=async s=>{if(s.preventDefault(),!(!t||!l.trim()||!r))try{await p.sendMessage({sender_id:t.id,receiver_id:r,message:l,read:!1}),m(""),g()}catch(a){f.error("Error sending message:",a)}},c=j.reduce((s,a)=>{const i=a.sender_id===(t==null?void 0:t.id)?a.receiver_id:a.sender_id;return s[i]||(s[i]=[]),s[i].push(a),s},{});return N?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(d.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(o,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Messages"}),e.jsx("p",{className:"text-gray-600",children:"Communicate with your team"})]})]}),e.jsxs("button",{className:"bg-blue-600 text-white px-6 py-3 rounded-lg font-medium flex items-center space-x-2 hover:bg-blue-700 transition-colors",children:[e.jsx(S,{className:"w-5 h-5"}),e.jsx("span",{children:"Start a conversation"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(d.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Conversations"}),Object.keys(c).length>0?e.jsx("div",{className:"space-y-2",children:Object.entries(c).map(([s,a])=>{const i=a[a.length-1],u=a.filter(y=>y.receiver_id===(t==null?void 0:t.id)&&!y.read).length;return e.jsx("button",{onClick:()=>v(s),className:`w-full text-left p-3 rounded-lg hover:bg-gray-50 transition-colors ${r===s?"bg-blue-50 border border-blue-200":""}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:["User ",s.slice(-4)]}),e.jsx("p",{className:"text-sm text-gray-600 truncate",children:i.message})]}),u>0&&e.jsx("span",{className:"bg-blue-600 text-white text-xs rounded-full px-2 py-1",children:u})]})},s)})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(o,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600",children:"No conversations yet"})]})]}),e.jsx(d.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"lg:col-span-2 bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:r?e.jsxs("div",{className:"h-96 flex flex-col",children:[e.jsx("div",{className:"flex-1 overflow-y-auto space-y-4 mb-4",children:(h=c[r])==null?void 0:h.map((s,a)=>e.jsx("div",{className:`flex ${s.sender_id===(t==null?void 0:t.id)?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-xs px-4 py-2 rounded-lg ${s.sender_id===(t==null?void 0:t.id)?"bg-blue-600 text-white":"bg-gray-100 text-gray-900"}`,children:[e.jsx("p",{className:"text-sm",children:s.message}),e.jsx("p",{className:`text-xs mt-1 ${s.sender_id===(t==null?void 0:t.id)?"text-blue-100":"text-gray-500"}`,children:new Date(s.sent_at).toLocaleTimeString()})]})},s.id))}),e.jsxs("form",{onSubmit:w,className:"flex space-x-2",children:[e.jsx("input",{type:"text",value:l,onChange:s=>m(s.target.value),placeholder:"Type a message...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:e.jsx(M,{className:"w-4 h-4"})})]})]}):e.jsx("div",{className:"h-96 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(o,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Select a conversation"}),e.jsx("p",{className:"text-gray-600",children:"Choose a conversation from the list to start messaging"})]})})})]})]})}export{D as MessagesPage};
