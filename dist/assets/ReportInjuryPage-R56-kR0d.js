import{j as e,m as g,k as E,b as P,r as k,P as R}from"./ui-D_jLh_Lr.js";import{o as b,s as j,p as S,a as T,$ as I,b as N,c as C,d as p,_,n as A,u as M}from"./forms-nhgmc8lX.js";import{p as h,l as O,u as D,c as L,a as U}from"./index-D5lOMFz8.js";import{r as y}from"./vendor-B9gohGc-.js";import"./supabase-DOoHAlwf.js";import"./router-CIHs1KQM.js";function v(i,t){try{var s=i()}catch(r){return t(r)}return s&&s.then?s.then(void 0,t):s}function q(i,t){for(var s={};i.length;){var r=i[0],o=r.code,c=r.message,a=r.path.join(".");if(!s[a])if("unionErrors"in r){var l=r.unionErrors[0].errors[0];s[a]={message:l.message,type:l.code}}else s[a]={message:c,type:o};if("unionErrors"in r&&r.unionErrors.forEach(function(d){return d.errors.forEach(function(m){return i.push(m)})}),t){var u=s[a].types,n=u&&u[r.code];s[a]=N(a,t,s,o,n?[].concat(n,r.message):r.message)}i.shift()}return s}function $(i,t){for(var s={};i.length;){var r=i[0],o=r.code,c=r.message,a=r.path.join(".");if(!s[a])if(r.code==="invalid_union"&&r.errors.length>0){var l=r.errors[0][0];s[a]={message:l.message,type:l.code}}else s[a]={message:c,type:o};if(r.code==="invalid_union"&&r.errors.forEach(function(d){return d.forEach(function(m){return i.push(m)})}),t){var u=s[a].types,n=u&&u[r.code];s[a]=N(a,t,s,o,n?[].concat(n,r.message):r.message)}i.shift()}return s}function z(i,t,s){if(s===void 0&&(s={}),function(r){return"_def"in r&&typeof r._def=="object"&&"typeName"in r._def}(i))return function(r,o,c){try{return Promise.resolve(v(function(){return Promise.resolve(i[s.mode==="sync"?"parse":"parseAsync"](r,t)).then(function(a){return c.shouldUseNativeValidation&&b({},c),{errors:{},values:s.raw?Object.assign({},r):a}})},function(a){if(function(l){return Array.isArray(l==null?void 0:l.issues)}(a))return{values:{},errors:j(q(a.errors,!c.shouldUseNativeValidation&&c.criteriaMode==="all"),c)};throw a}))}catch(a){return Promise.reject(a)}};if(function(r){return"_zod"in r&&typeof r._zod=="object"}(i))return function(r,o,c){try{return Promise.resolve(v(function(){return Promise.resolve((s.mode==="sync"?S:T)(i,r,t)).then(function(a){return c.shouldUseNativeValidation&&b({},c),{errors:{},values:s.raw?Object.assign({},r):a}})},function(a){if(function(l){return l instanceof I}(a))return{values:{},errors:j($(a.issues,!c.shouldUseNativeValidation&&c.criteriaMode==="all"),c)};throw a}))}catch(a){return Promise.reject(a)}};throw new Error("Invalid input: not a Zod schema")}function V(i={}){const{maxRetries:t=3,retryDelay:s=1e3,exponentialBackoff:r=!0}=i,[o,c]=y.useState({hasError:!1,error:null,retryCount:0,lastRetryTime:null}),a=y.useCallback((m,x)=>{O.error(`Error in ${x||"unknown context"}:`,m),c(w=>({hasError:!0,error:m,retryCount:w.retryCount+1,lastRetryTime:Date.now()}));const f=W(m,x);h({type:"error",message:f,duration:5e3})},[]),l=y.useCallback(()=>{c({hasError:!1,error:null,retryCount:0,lastRetryTime:null})},[]),u=y.useCallback(async m=>{if(o.retryCount>=t){h({type:"error",message:"Maximum retry attempts reached. Please refresh the page or contact support."});return}const x=r?s*Math.pow(2,o.retryCount):s;h({type:"info",message:`Retrying... (${o.retryCount+1}/${t})`,duration:x}),await new Promise(f=>setTimeout(f,x));try{l(),await m()}catch(f){a(f,"retry operation")}},[o.retryCount,t,s,r,l,a]),n=o.retryCount<t,d=o.lastRetryTime&&Date.now()-o.lastRetryTime<5e3;return{...o,handleError:a,clearError:l,retry:u,canRetry:n,isRetrying:d}}function W(i,t){const s=i.message.toLowerCase();return s.includes("fetch")||s.includes("network")||s.includes("connection")?"Network error. Please check your internet connection and try again.":s.includes("auth")||s.includes("unauthorized")||s.includes("401")?"Authentication error. Please log in again.":s.includes("forbidden")||s.includes("403")?"You don't have permission to perform this action.":s.includes("not found")||s.includes("404")?"The requested resource was not found.":s.includes("500")||s.includes("server error")?"Server error. Please try again later or contact support.":s.includes("timeout")?"Request timed out. Please try again.":s.includes("validation")||s.includes("invalid")?"Invalid data provided. Please check your input and try again.":t?`Error in ${t}. Please try again.`:"An unexpected error occurred. Please try again."}function B(i,t){const[s,r]=y.useState(!1),{handleError:o}=V();return{execute:y.useCallback(async(...a)=>{var l,u;r(!0);try{const n=await i(...a);return(l=t==null?void 0:t.onSuccess)==null||l.call(t,n),t!=null&&t.showSuccessToast&&h({type:"success",message:t.successMessage||"Operation completed successfully"}),n}catch(n){const d=n instanceof Error?n:new Error("Unknown error");throw(u=t==null?void 0:t.onError)==null||u.call(t,d),o(d,"async operation"),n}finally{r(!1)}},[i,t,o]),loading:s}}const H=C({injuryType:p().min(1,"Injury type is required"),bodyPart:p().min(1,"Body part is required"),severity:_(["mild","moderate","severe","critical"]),description:p().min(10,"Description must be at least 10 characters"),dateOccurred:p().min(1,"Date occurred is required"),activityWhenInjured:p().optional(),painLevel:A().min(0).max(10).optional()});function Q(){const{user:i}=D(),{register:t,handleSubmit:s,formState:{errors:r},reset:o}=M({resolver:z(H)}),{execute:c,loading:a}=B(async n=>{if(!i)throw new Error("User not authenticated");const d={student_id:i.id,injury_type:n.injuryType,body_part:n.bodyPart,severity:n.severity,description:n.description,date_occurred:n.dateOccurred,activity_when_injured:n.activityWhenInjured,pain_level:n.painLevel};return await U.createInjury(d)},{onSuccess:()=>{h({type:"success",message:"Injury reported successfully!"}),o()},showSuccessToast:!1}),l=n=>{c(n)},u=[{value:"mild",label:"Mild",color:"text-yellow-600"},{value:"moderate",label:"Moderate",color:"text-orange-600"},{value:"severe",label:"Severe",color:"text-red-600"},{value:"critical",label:"Critical",color:"text-red-800"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center",children:e.jsx(E,{className:"w-6 h-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Report Injury"}),e.jsx("p",{className:"text-gray-600",children:"Report a new injury to get help from our medical team"})]})]}),e.jsxs(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Injury Details"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Please provide detailed information about your injury"})]}),e.jsxs("form",{onSubmit:s(l),className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Injury Type *"}),e.jsx("input",{...t("injuryType"),type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"e.g., Ankle sprain, Hamstring strain"}),r.injuryType&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.injuryType.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Body Part *"}),e.jsx("input",{...t("bodyPart"),type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"e.g., Left ankle, Right knee"}),r.bodyPart&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.bodyPart.message})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Severity *"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:u.map(n=>e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{...t("severity"),type:"radio",value:n.value,className:"text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:`text-sm font-medium ${n.color}`,children:n.label})]},n.value))}),r.severity&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.severity.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description *"}),e.jsx("textarea",{...t("description"),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Describe your injury in detail, including symptoms and how it occurred..."}),r.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.description.message})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date of Injury *"}),e.jsxs("div",{className:"relative",children:[e.jsx(P,{className:"w-5 h-5 text-gray-400 absolute left-3 top-1/2 transform -translate-y-1/2"}),e.jsx("input",{...t("dateOccurred"),type:"date",className:"pl-10 w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),r.dateOccurred&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.dateOccurred.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Activity When Injured"}),e.jsxs("div",{className:"relative",children:[e.jsx(k,{className:"w-5 h-5 text-gray-400 absolute left-3 top-1/2 transform -translate-y-1/2"}),e.jsx("input",{...t("activityWhenInjured"),type:"text",className:"pl-10 w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"e.g., Rugby practice, Gym workout"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pain Level (0-10)"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("input",{...t("painLevel",{valueAsNumber:!0}),type:"range",min:"0",max:"10",className:"flex-1"}),e.jsx("span",{className:"text-sm text-gray-600 min-w-[2rem] text-center",children:t("painLevel").value||0})]}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[e.jsx("span",{children:"No pain"}),e.jsx("span",{children:"Severe pain"})]})]}),e.jsx(g.button,{whileHover:{scale:1.02},whileTap:{scale:.98},type:"submit",disabled:a,className:"w-full bg-red-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center space-x-2",children:a?e.jsx(L,{size:"sm",text:"Reporting Injury..."}):e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-5 h-5"}),e.jsx("span",{children:"Report Injury"})]})})]})]})]})}export{Q as ReportInjuryPage};
